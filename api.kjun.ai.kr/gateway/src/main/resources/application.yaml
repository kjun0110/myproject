spring:
  application:
    name: gateway
  cloud:
    config:
      enabled: false
    # 서비스 디스커버리 설정
    # 현재: 직접 URL 사용 (Docker 환경)
    # 나중에 쿠버네티스 사용 시: lb:// 사용 가능 (LoadBalancer 의존성 유지)
    discovery:
      enabled: false  # 현재는 직접 URL 사용하므로 비활성화
      # 쿠버네티스 사용 시 활성화하고 아래 설정 사용:
      # simple:
      #   instances:
      #     auth-service:
      #       - uri: http://authservice:8081
    # LoadBalancer 활성화 (쿠버네티스 전환 시 lb:// 사용을 위해 유지)
    loadbalancer:
      enabled: true
    gateway:
      # CORS 설정 (Gateway에서만 처리)
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins:
              - "http://localhost:3000"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
              - PATCH
            allowedHeaders: "*"
            allowCredentials: true
            maxAge: 3600
      # 라우팅 설정
      routes: # 라우팅 설정 계속 추가 하면 됨
        # /auth 서브라우터 - auth-service로 라우팅
        - id: auth-service
          # 현재: 직접 URL 사용 (Docker 환경)
          uri: http://authservice:8081
          # 쿠버네티스 사용 시: lb://auth-service로 변경
          # uri: lb://auth-service
          predicates:
            - Path=/api/auth/**
          filters:
            # /api/auth prefix 제거하고 나머지 경로만 전달
            # /api/auth/kakao → /kakao
            - RewritePath=/api/auth/(?<segment>.*), /${segment}
        # 카카오 OAuth2 콜백 라우팅
        - id: kakao-callback
          uri: http://authservice:8081
          predicates:
            - Path=/auth/kakao/callback
          filters:
            # /auth/kakao/callback → /kakao/callback
            - RewritePath=/auth/kakao/callback, /kakao/callback

server:
  port: 8080

springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /docs  # /docs 경로로 Swagger UI 접근
    enabled: true  # Swagger UI 활성화
    operations-sorter: method
    tags-sorter: alpha
    use-root-path: false  # 루트 경로 사용 안 함
    persist-authorization: true  # 인증 정보 브라우저에 저장
    show-actuator: false  # Actuator 엔드포인트 숨김
    default-flat-param-object: true  # 파라미터 객체 평면화
    writer-with-order-by-keys: true  # 키 순서대로 작성


# 로깅 설정
logging:
  level:
    org.springframework.cloud.client.discovery: INFO
    org.springframework.cloud.loadbalancer: INFO
    org.springframework.cloud.gateway: INFO  # DEBUG에서 INFO로 변경하여 긴 필터 로그 제거
    org.springframework.cloud.gateway.handler.FilteringWebHandler: WARN  # 필터 목록 로그 제거

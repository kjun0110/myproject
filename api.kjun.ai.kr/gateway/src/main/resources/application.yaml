spring:
  application:
    name: gateway
  
  cloud:
    config:
      enabled: false
    discovery:
      enabled: false
    loadbalancer:
      enabled: true
    
    gateway:
      # CORS 설정: 프론트엔드(localhost:3000)에서의 요청 허용
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins:
              - "http://localhost:3000"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
              - PATCH
            allowedHeaders: "*"
            allowCredentials: true
            maxAge: 3600
      
      # 라우팅 설정
      routes:
        # Auth Service API: /api/auth/** → auth-service로 라우팅
        - id: auth-service
          uri: http://authservice:8081
          predicates:
            - Path=/api/auth/**
          filters:
            # /api/auth/kakao → /kakao로 경로 변환
            - RewritePath=/api/auth/(?<segment>.*), /${segment}
        
        # 카카오 OAuth 콜백: /auth/kakao/callback → /kakao/callback
        - id: kakao-callback
          uri: http://authservice:8081
          predicates:
            - Path=/auth/kakao/callback
          filters:
            - RewritePath=/auth/kakao/callback, /kakao/callback
        
        # 네이버 OAuth 콜백: /auth/naver/callback → /naver/callback
        - id: naver-callback
          uri: http://authservice:8081
          predicates:
            - Path=/auth/naver/callback
          filters:
            - RewritePath=/auth/naver/callback, /naver/callback
        
        # 구글 OAuth 콜백: /auth/google/callback → /google/callback
        - id: google-callback
          uri: http://authservice:8081
          predicates:
            - Path=/auth/google/callback
          filters:
            - RewritePath=/auth/google/callback, /google/callback
        
        # Crawler Service API: /api/crawler/** → crawler-service로 라우팅
        - id: crawler-service
          uri: http://crawlerservice:9002
          predicates:
            - Path=/api/crawler/**
          filters:
            # /api/crawler/** → /**로 경로 변환
            - RewritePath=/api/crawler/(?<segment>.*), /${segment}
        
        # Crawler Service 루트 경로: /crawler/** → crawler-service로 라우팅
        - id: crawler-service-root
          uri: http://crawlerservice:9002
          predicates:
            - Path=/crawler/**
          filters:
            - RewritePath=/crawler/(?<segment>.*), /${segment}
        
        # Titanic Service API: /api/titanic/** → tatanic-service로 라우팅
        - id: tatanic-service
          uri: http://tatanic:9001
          predicates:
            - Path=/api/titanic/**
          filters:
            # /api/titanic/** → /**로 경로 변환
            - RewritePath=/api/titanic/(?<segment>.*), /${segment}
            # CORS 헤더 제거 (게이트웨이에서만 처리)
            - RemoveResponseHeader=Access-Control-Allow-Origin
            - RemoveResponseHeader=Access-Control-Allow-Methods
            - RemoveResponseHeader=Access-Control-Allow-Headers
            - RemoveResponseHeader=Access-Control-Allow-Credentials

# 서버 포트
server:
  port: 8080

# Swagger UI 설정: /docs 경로로 접근
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /docs
    enabled: true
    operations-sorter: method
    tags-sorter: alpha
    use-root-path: false
    persist-authorization: true
    show-actuator: false
    default-flat-param-object: true
    writer-with-order-by-keys: true

# 로깅 레벨 설정
logging:
  level:
    org.springframework.cloud.client.discovery: INFO
    org.springframework.cloud.loadbalancer: INFO
    org.springframework.cloud.gateway: INFO
    org.springframework.cloud.gateway.handler.FilteringWebHandler: WARN
